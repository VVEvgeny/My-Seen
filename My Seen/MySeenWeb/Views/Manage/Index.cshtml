@model MySeenWeb.Models.IndexViewModel

@Scripts.Render("~/bundles/jquery")

@{
    ViewBag.Title = Resource.Manage;
}

<h2>@Resource.Manage.</h2>

<p class="text-success">@ViewBag.StatusMessage</p>
<div>
    <h4>@Resource.ChangeYourAccountSettings</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>@Resource.Password:</dt>
        <dd>
            [
            @(Model.HasPassword ? Html.ActionLink(Resource.ChangeYourPassword, "ChangePassword") : Html.ActionLink(Resource.Create, "SetPassword"))
            ]
        </dd>
        <dt>@Resource.ExternalLogins:</dt>
        <dd>
            @Model.Logins.Count [
            @Html.ActionLink(Resource.Manage, "ManageLogins") ]
        </dd>
    </dl>
    <dl class="dl-horizontal">
        <dt>@Resource.SelectLanguage</dt>
        <dd>
            @Html.DropDownList("Lang", Model.LangList, new { @class = "form-control", @id = "lstLang", @style = "width: 200px;" })
        </dd>
    </dl>
    <dl class="dl-horizontal">
        <dt>@Resource.RecordPerPage</dt>
        <dd>
            @Html.DropDownList("Rpp", Model.RppList, new {@class = "form-control", @id = "lstRpp", @style = "width: 200px;"})
            <div id="RPPSaved" style="display: none;" class="text-success">@Resource.Saved</div>
        </dd>
    </dl>
    <dl class="dl-horizontal">
        <dt>@Resource.MarkersOnRoads</dt>
        <dd>
            @Html.DropDownList("MarkersOnRoads", Model.MarkersOnRoadsList, new { @class = "form-control", @id = "lstMoR", @style = "width: 200px;" })
            <div id="MarkersOnRoadsSaved" style="display: none;" class="text-success">@Resource.Saved</div>
        </dd>
    </dl>
    <!--
        @if (Model.HaveData)
        {
            <dl class="dl-horizontal">
                <dt>@Resource.DeleteData</dt>
                <dd>
                    <button type="button" class="btn btn-danger btn-xs" id="delDataButton" style="width: 200px;">
                        <span class="glyphicon glyphicon-trash"></span>
                        &nbsp;@Resource.DeleteData
                    </button>
                </dd>
            </dl>
        }
        -->
</div>

<footer class="row">
    <div class="text-center">
        <p class="text-muted small">@Resource.SiteVersion @Versions.Web / @Resource.LibraryVersion @Resource.LibVersionNum</p>
    </div>
</footer>

<script language="javascript" type="text/javascript">
        (function ($) {
            $(function () {
                var $delDataButton = $('#delDataButton');
                var $select = $('#lstLang');
                var $selectRpp = $('#lstRpp');
                var $selectMoR = $('#lstMoR');

                $select.on('change', function ()
                {
                    var value = $(this).val();

                    $.ajax({
                        type: 'POST',
                        url: '/Manage/ChangeLanguage',
                        data: {
                            selected: value
                        },
                        dataType: 'json',
                        success: function () {
                            window.location.href = '/Manage';
                        },
                        error: function () {
                            alert('Error');
                        }
                    });
                    return false;
                });

                $selectRpp.on('change', function () {
                    var value = $(this).val();

                    $.ajax({
                        type: 'POST',
                        url: '/Manage/ChangeRpp',
                        data: {
                            selected: value
                        },
                        dataType: 'json',
                        success: function ()
                        {
                            var $div = $('#RPPSaved');
                            $div.show();
                            window.setTimeout(hideRppSaved, 2000);
                        },
                        error: function () {
                            alert('Error');
                        }
                    });
                    return false;
                });

                $selectMoR.on('change', function () {
                    var value = $(this).val();

                    $.ajax({
                        type: 'POST',
                        url: '/Manage/ChangeMoR',
                        data: {
                            selected: value
                        },
                        dataType: 'json',
                        success: function () {
                            var $div = $('#MarkersOnRoadsSaved');
                            $div.show();
                            window.setTimeout(hideMoRSaved, 2000);
                        },
                        error: function () {
                            alert('Error');
                        }
                    });
                    return false;
                });

                $delDataButton.on('click', function () {
                    $.ajax({
                        type: 'POST',
                        url: '/Manage/DeleteData',
                        dataType: 'json',
                        success: function () {
                            window.location.href = '/Manage';
                        },
                        error: function () {
                            alert('Error');
                        }
                    });
                    return false;
                });
            });
            function hideRppSaved()
            {
                var $div = $('#RPPSaved');
                $div.hide();
            }
            function hideMoRSaved() {
                var $div = $('#MarkersOnRoadsSaved');
                $div.hide();
            }
        })(jQuery);
</script>